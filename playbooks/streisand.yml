- name: Prepare the new server for Ansible
# =========================================
  hosts: streisand-host
  gather_facts: no

  remote_user: "root"
  become: true

  tasks:
    - name: Install Python using a raw SSH command to enable the execution of Ansible modules
      raw: apt update && apt install python -y
      args:
        executable: /bin/bash


- name: Configure the Server and install required software
# ========================================================
  hosts: streisand-host

  remote_user: "root"
  become: true

  roles:
    - {role: common}
    # OpenConnect must be set up before L2TP/IPsec in order to avoid
    # compilation issues.
    - {role: openconnect, when: hostvars.localhost.enable_openconnect}
    - {role: l2tp-ipsec, when: hostvars.localhost.enable_l2tp_ipsec}
    - {role: openvpn, when: hostvars.localhost.enable_openvpn}
    - {role: stunnel, when: hostvars.localhost.enable_stunnel}
    - {role: shadowsocks, when: hostvars.localhost.enable_shadowsocks}
    - {role: ssh}
    - {role: tinyproxy}
    - {role: tor-bridge, when: hostvars.localhost.enable_tor}
    - {role: sslh}
    - {role: monit}
    - {role: ufw}
    - {role: wireguard, when: hostvars.localhost.enable_wireguard}
    - {role: streisand-mirror}
    - {role: streisand-gateway}
